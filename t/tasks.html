<ng-include src="'t/sidebar.html'"></ng-include>
<div class="sca-sidebar-page">
    <div class="subbar">
        <div style="padding-left: 20px; margin-bottom: 10px;">
            <h2>Jobs</h2>
            <p class="help-block">Show all jobs that you have submitted</p>
            <br>
            <div class="btn-group pull-right" style="left: -20px;top: -5px;">
                <button class="btn btn-xs btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Options <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                <li><a href>Project ABC</a></li>
                <li><a href>Project DEF</a></li>
                <li><a href>Project AAA</a></li>
                <li role="separator" class="divider"></li>
                <li><a href>Separated link</a></li>
                </ul>
            </div>
            <span class="text-muted">{{jobs.length}} Jobs</span>
        </div>
        <hr style="margin: 0px;">

        <div class="subbar-list">
            <p class="alert alert-info" ng-if="jobs.length == 0">Please submit your job first.</p>
            <div class="subbar-list-item" 
                ng-repeat="job in jobs"
                ng-class="{'active': selected_main == job}"
                ng-click="select(job)">

                <small><taskstatus status="job.status" class="pull-right"></taskstatus></small>
                <div class="list-header">{{job.desc}}</div>
                <small>
                    <time class="text-muted" style="position: relative; top: -4px;">{{job.create_date | date}}</time>
                    <p>
                        <code>dwi</code>{{job.config._form.dwi|filename}}
                        <code>t1</code>{{job.config._form.t1|filename}}
                    </p>
                </small>
            </div>
        </div><!--workflow-->

    </div><!--subbar-->
    <div class="subbar-content">
        <!--
        <div class="margin30" ng-if="!selected_main">
            <br>
            <p class="alert alert-info">Please select a job</p>
        </div>
        -->
        <div class="margin30" ng-if="selected_main">
            <div class="fixed-top">
                <h2 class="pull-right">
                    <i class="fa fa-trash-o" aria-hidden="true" ng-click="delete()"></i>&nbsp;&nbsp;&nbsp;
                    <i class="fa fa-info-circle" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;
                    <i class="fa fa-star-o" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;
                    <i class="fa fa-share-alt" aria-hidden="true"></i>&nbsp;&nbsp;&nbsp;

                    <span class="pull-right">
                        <button ng-if="selected_main.status == 'running' || selected_main.status == 'requested'" type="button" class="btn" ng-model="selected_app.locked">
                            <i class="fa fa-stop" aria-hidden="true"></i> Stop
                        </button>
                    </span>
                </h2>
                <h2 class="page-heading">{{selected_main.desc}}</h2>
            </div>  
            <div style="padding-top: 50px;">
                <!--
                <a class="pull-right"
                    style="color: black; position: relative; right: 10px; top: 10px;"
                    ng-if="!selected_main.show_detail"
                    ng-click="selected_main.show_detail = true">
                    <i class="fa fa-caret-right" aria-hidden="true"></i> See Job Detail
                </a>
                -->
                <div ng-if="selected_main.status == 'requested' || selected_main.status == 'running'">
                    <h3 class="text-info"><strong><i class="fa fa-cog fa-spin" aria-hidden="true"></i> Processing ...</strong></h3>
                    <p class="alert bg-info">
                        The process should take anywhere between 10 - 24 hours depending on the availability of computing resources and the size of your input data. You may close this page and we will send you an email once the processing is completed.</p>
                </div>
                <div ng-if="selected_main.status == 'failed'">
                    <h3 class="text-danger"><strong>Processing Failed</strong></h3>
                    <p class="alert bg-danger">Sorry! Please contact the support team for more information.</p>
                </div>
                <div ng-if="selected_main.status == 'finished'">
                    <h3 class="text-success"><strong>Finished!</strong></h3>
                    <p><!--placeholder-->&nbsp;</p>
                </div>

                <div class="workflow">
                    <div class="workflow-item" ng-repeat="task in selected">
                        <div class="item-header item-header-status" ng-class="{
                            'item-header-status-failed': task.status == 'failed',
                            'item-header-status-finished': task.status == 'finished',
                            'item-header-status-running': task.status == 'running'  }">
                            <span class="item-header-badge">{{$index+1}}</span> 
                            <div class="item-header-addon">
                                <span class="label label-default item-header-task"> {{task.name}}</span><span class="label label-default item-header-status">
                                    <!--<strong>{{task.status}}</strong>-->
                                    <i ng-if="task.status == 'running'" class="fa fa-cog fa-spin text-muted" aria-hidden="true"></i>
                                    <small>{{task.status_msg|cut:true:130:'...'}}</small>
                                </span>
                            </div>
                        </div>
                        <!--
                        <h5 ng-click="show_progress(task)">
                            <taskstatus status="task.status"></taskstatus><span class="label label-default">{{task.status_msg|cut:true:130:'...'}}</span>
                        </h5>
                        -->

                        <!--task specific details-->
                        <div ng-switch="task.name">
                            <div ng-switch-when="freesurfer">
                                <p class="help-block">Subdivide the brain into major tissue and anatomical regions using FreeSurfer (2 to 10h compute time).</p>

                                <div ng-if="task.status == 'finished'">
                                    <a style="cursor: pointer;" ng-if="!task.show_vtk" ng-click="task.show_vtk = true">
                                        <small><i class="fa fa-caret-right" aria-hidden="true"></i> Show 3D Model (lh/rh.piel / .vtk)</small>
                                    </a>
                                    <a style="cursor: pointer;" ng-if="task.show_vtk" ng-click="task.show_vtk = false">
                                        <small><i class="fa fa-caret-right" aria-hidden="true"></i> Hide 3D Model (lh/rh.piel / .vtk)</small>
                                    </a>
                                    <div class="row" ng-if="task.show_vtk">
                                    <div class="col-lg-6">
                                        <h4>Left Hemisphere</h4>
                                        <vtkview resourceid="task.resource_id" 
                                            url="task.instance_id+'/'+task._id+'/lh.10.vtk'"></vtkview>
                                    </div>
                                    <div class="col-lg-6">
                                        <h4>Right Hemishpere</h4>
                                        <vtkview resourceid="task.resource_id" 
                                            url="task.instance_id+'/'+task._id+'/rh.10.vtk'"></vtkview>
                                    </div>
                                    </div><!--row-->
                                </div>
                            </div>
                            <div ng-switch-when="neuro-tracking">
                                <p class="help-block">Tracking white matter fascicles (1 h compute time).</p>
                                <div ng-if="task.status == 'finished'">
                                    <!--nothing to show for now-->
                                </div>
                            </div>
                            <div ng-switch-when="life">
                                <p class="help-block">Evaluating white matter fascicles and removing false alarms (5 h compute time).</p>
                                <div ng-if="task.status == 'finished'">
                                    <a style="cursor: pointer;" ng-if="!task.show_lifeplot" ng-click="task.show_lifeplot = true">
                                        <small><i class="fa fa-caret-right" aria-hidden="true"></i> Show Life Plots</small>
                                    </a>
                                    <a style="cursor: pointer;" ng-if="task.show_lifeplot" ng-click="task.show_lifeplot = false">
                                        <small><i class="fa fa-caret-right" aria-hidden="true"></i> Hide Life Plots</small>
                                    </a>
                                    <lifeplot ng-if="task.show_lifeplot" task="task"></lifeplot>
                                </div>
                            </div>
                            <div ng-switch-when="connectome-comparison">
                                <p class="help-block">Compare connectome properties generated with the data provided with those stored in the data base (10 minutes compute time).</p>
                                <div ng-if="task.status == 'finished' && freesurfer_task.status == 'finished'">
                                    <a style="cursor: pointer;" ng-if="!task.show_tracts" ng-click="task.show_tracts = true">
                                        <small><i class="fa fa-caret-right" aria-hidden="true"></i> Show 3D Tracts</small>
                                    </a>
                                    <a style="cursor: pointer;" ng-if="task.show_tracts" ng-click="task.show_tracts = false">
                                        <small><i class="fa fa-caret-down" aria-hidden="true"></i> Hide 3D Tracts</small>
                                    </a>
                                </div>

                            </div>
                            <div ng-switch-default>
                                <p class="help-block">Behind the scene task..</p>
                            </div>
                        </div><!--task.name switch-->

                        <a style="cursor: pointer;" ng-if="!task.show_output" ng-click="task.show_output = true">
                            <small><i class="fa fa-caret-right" aria-hidden="true"></i> Show Raw Outputs</small>
                        </a>
                        <a style="cursor: pointer;" ng-if="task.show_output" ng-click="task.show_output = false">
                            <small><i class="fa fa-caret-down" aria-hidden="true"></i> Hide Raw Outputs</small>
                        </a>
                        <sca-product-raw ng-if="task.show_output" taskid="task._id"></sca-product-raw>

                        <!-- displaying comparision result outside of workflow area for more space-->
                        <div ng-if="task.name == 'connectome-comparison' && task.status == 'finished'" style="margin-left: -55px;">
                            <br>
                            <tractsview ng-if="task.show_tracts" task="task" freesurfer="freesurfer_task"></tractsview>
                            <comparisonplot task="task"></comparisonplot>
                        </div>

                    </div><!--detail/ng-repeast workflow-item-->

                </div><!--workflow-->

                <hr>
                <submitdetail detail="selected_main.config._form"></submitdetail>

            </div><!--workflow-->
            <!--
            <br><br>
            <br><br>
            <br><br>
            <br><br>
            <br><br>
            <h4>Debug</h4>
            <div class="task" ng-repeat="task in selected">
                <pre>{{task|json}}</pre>
            </div>
            -->
        </div><!--magin30-->
    </div><!--subbar-->
</div><!--sca-sidebbar-page-->
